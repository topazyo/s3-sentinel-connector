id: 6dfed10b-c4b9-45d9-95d7-4f34857b8db4
name: High Volume Firewall Denies from Single Source IP
description: |
  Detects high volumes of denied or dropped firewall events from a single source IP
  in the Custom_Firewall_CL table ingested by the AWS S3 Sentinel connector.
severity: Medium
status: Available
requiredDataConnectors:
  - connectorId: S3SentinelConnector_FunctionApp
    dataTypes:
      - Custom_Firewall_CL
queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
tactics:
  - InitialAccess
relevantTechniques:
  - T1190
query: |
  Custom_Firewall_CL
  | where TimeGenerated >= ago(1h)
  | where tolower(Action) in ('deny', 'drop')
  | summarize DeniedEvents=count(),
      FirstSeen=min(TimeGenerated),
      LastSeen=max(TimeGenerated)
      by SourceIP, DestinationIP
  | where DeniedEvents >= 100
  | project FirstSeen, LastSeen, SourceIP, DestinationIP, DeniedEvents
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SourceIP
version: 1.0.0
kind: Scheduled